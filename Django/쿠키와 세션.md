# 쿠키와 세션

## Cookie & Session 정리

<br>

쿠키와 세션은 HTTP의 특징이자 약점인 <br>`connectionless`(비연결성 : 서버가 요청에 맞는 응답을 전송한 후, 연결을 끊는다.), <br>`stateless`(무상태 프로토콜 : 서버가 클라이언트의 상태를 보존하지 않는다.)<br>을 보완하여 `사용자의 정보를 지속적으로 확인`하기 위해 사용한다.

ex) 로그인 정보, 상품 장바구니 품목, 사용자 맞춤 테마 등등..

<br>

---

## (1) 쿠키(Cookie)의 특징

<br>

- 사용자가 웹페이지를 방문할 경우, 사이트를 운용하는 서버에서 `사용자의 컴퓨터에 저장하는 정보파일`로, 필요시 정보를 `참조`하거나 `재사용` 할 수 있다.

- 사용자가 접속시 쿠키가 없다면, 처음 방문한 것으로 인식하고, 고유한 식별자를 생성한다.

<특징>

1. 이름, 값, 만료일(expire, max-age), 경로정보 등으로 구성된다.
2. 클라이언트에 `총 3000개`의 쿠키를 저장할 수 있다.
3. 하나의 `도메인 당 50개`의 쿠키를 가질 수 있다.
4. 하나의 쿠키는 `4KB(=4096byte)`까지 저장 가능하다.

출처 : RFC(Request for Comments: 인터넷에서 기술을 구현하는데 필요한 절차를 제공하는 공문서 간행물) 6265 - 6.1. Limits

https://www.rfc-editor.org/rfc/rfc6265#section-6.1

```
o  At least 4096 bytes per cookie (as measured by the sum of the
    length of the cookie's name, value, and attributes).

o  At least 50 cookies per domain.

o  At least 3000 cookies total.
```

<br>

<쿠키동작 순서>

1. 클라이언트가 웹페이지 요청(=사용자가 웹페이지에 접속)
2. 서버는 쿠키를 생성
3. 생성한 쿠키와 함께 http화면을 응답
4. 응답받은 쿠키는 사용자의 로컬 PC에 저장
5. 클라이언트는 서버에 다른 요청을 보낼 때, 쿠키를 함께 전송

<br>
<br>

---

## (2) 세션(Session)의 특징

<br>

- 일정시간 동안 동일한 사용자로부터 들어오는 요청을 하나의 상태로 보고, `그 상태를 유지`시키는 기술

- 일정시간은 서버에 `접속한 시점`부터 브라우저를 `종료`하여 연결이 끝나는 시점까지를 의미함.

- 사용자가 `접속한 상태`를 하나의 단위로 보고 그것을 `세션`이라고 한다.

<특징>

1. 서버에 상태유지를 위한 `정보(:세션 쿠키)를 저장`한다.
2. `브라우저를 닫거나`, 서버를 삭제할 때, 삭제되므로 쿠키보다 보안이 좋다.
3. 서버용량이 허용하는 기준에서 `저장데이터의 제한이 없다`.
4. 각 클라이언트에 고유 `Session ID를 부여`한다. Session ID로 클라이언트를 구분하여 맞는 서비스를 제공한다.

<br>

<세션동작 순서>

1. 클라이언트가 웹페이지 요청(=사용자가 웹페이지에 접속)
2. 서버는 클라이언트의 Request-Header 필드인 쿠키를 확인하여, Session ID를 보냈는지 확인
3. 존재하지 않으면, 서버는 Session ID를 생성하여, 클라이언트에게 응답
4. 서버는 Session ID를 쿠키를 사용하여 서버에 저장
5. 클라이언트의 재접속시, 쿠키를 이용하여, Session ID값과 함께 서버에 요청

<br>
<br>

---

## (3) 쿠키와 세션의 차이

<br>

- 둘 다 `비슷한 역할`을 수행, 동작원리도 비슷함.(=세션도 결국 쿠키를 사용)
- 쿠키는 서버를 전혀 사용하지 않으며, `세션은 서버를 활용`하는 것이 큰 차이점이다.
- 세션이 보안이 더 우수함
    - `쿠키`는 정보가 `로컬`에 저장되기에 변형될 수 있거나, 정보를 스니핑(탈취) 당할 우려가 있음
    - `세션`은 Session ID만 저장하고 `처리는 서버`에서 일어나며, 브라우저 종료시, 삭제됨으로 보안성이 높다.
- 속도는 쿠키가 우수함
    - `쿠키`에 정보가 담겨 있어 요청시, `속도가 빠르다.`
    - `세션`은 정보가 서버에 있기에 `처리가 필요하여 속도가 느리다.`
- 쿠키와 세션 둘 다 각각 보안, 속도의 장단점이 있기 때문에 병행하여 사용한다.

<br>
<br>

---

## (4) 쿠키 & 세션 활용 로그인 과정

<br>

1. 쿠키에서 로그인과정

   쿠키는 로컬에 정보가 저장되어있으며 로그인시, 쿠키정보를 요청에 담아 보내고 서버의 쿠키값을 확인하여 로그인된다. 따라서 재접속하더라도 계속 로그인 상태를 유지한다.

2. 세션에서 로그인과정

   세션은 정보는 서버에 있고, 서버에서 발급한 Session ID만 가지고 있으며, 로그인시, 세션은 Session ID를 요청에 담아 보내고, 서버에서 처리하여 정보를 보내준다. 따라서 브라우저를 종료하면, 해당 Session ID는 삭제된다.

- `일반 로그인`의 경우, `세션`을 이용해 보안성을 높이고 / `로그인 유지`의 경우, `쿠키`를 사용해 계속해서 정보를 가지고 있으며, 로그인의 속도를 높인다.